<<<<<<< HEAD
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>L'aventure de Soso et Nana</title>
<style>
html, body { margin: 0; height: 100%; overflow: hidden;  background-image: url('./textures/love.jpg');  background-size: cover;       /* couvre tout l'√©cran */
  background-position: center;  /* centr√©e */
  background-repeat: no-repeat;
font-family: sans-serif; }
#titleScreen, #introText, #npcHint, #quizText {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  text-align: center;
  max-width: 600px;
}
#titleScreen button, #quizText button {
  margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 6px;
}
#npcHint { display:none; font-size: 18px; }
</style>
</head>
<body>

<div id="titleScreen">
  <h1>L'aventure de Soso et Nana</h1>
  <button id="startBtn">Jouer</button>
</div>

<div id="introText" style="display:none;">
  Bonjour Sonia, te voil√† dans la peau de Snoopy afin de traverser une super aventure sem√©e d'emb√ªches pour d√©couvrir l'activit√© pr√©vue aujourd'hui. Ta premi√®re mission est d'aller s√©duire ce beau gar√ßon avec son t-shirt Gorillaz, te souviens-tu de tout ?<br>
  <small>Appuye sur Entr√©e pour continuer</small>
</div>

<div id="npcHint">Appuye sur E pour lui parler</div>

<div id="quizText" style="display:none;">
  <p id="questionText"></p>
  <div id="answers"></div>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/loaders/GLTFLoader.js';

let scene, camera, renderer, clock = new THREE.Clock();
let player, mixer, npc;
let keys = { z:false, q:false, s:false, d:false };
let introDone = false;
const moveSpeed = 0.08;
const npcDistance = 2;

const startBtn = document.getElementById('startBtn');
const titleScreen = document.getElementById('titleScreen');
const introText = document.getElementById('introText');
const npcHint = document.getElementById('npcHint');
const quizText = document.getElementById('quizText');
const questionText = document.getElementById('questionText');
const answersDiv = document.getElementById('answers');

const quiz = [
  { q: "Quel artiste j'avais en fond d'√©cran lorsqu'on a commenc√© √† se parler ?", a: ["Khali", "Ptite Soeur", "Frank Ocean"], correct: 2 },
  { q: "Quel pull que je portais √† la soir√©e halloween (quand je suis tomb√© amoureux) ?", a: ["Pull MMI 1√®re ann√©e", "Mon pull gris que tu aimes bien", "Mon pull blanc avec un R"], correct: 1 },
  { q: "Quel wikihow j'ai consult√© la premi√®re fois qu'on s'est vraiment parler ?", a: ["Comment gagner une bagarre", "Comment √©viter d'√™tre agress√© dans la rue", "Comment se cacher d'un tueur"], correct: 2 },
];
let currentQuestion = 0;

startBtn.onclick = () => {
  titleScreen.style.display = 'none';

  // üîπ on initialise le d√©cor tout de suite
  init();

  // üîπ on affiche le texte d'intro par-dessus
  introText.style.display = 'block';
  document.addEventListener('keydown', introContinue);

  // üîπ on commence quand m√™me l'animation pour voir le d√©cor en arri√®re-plan
  animate();
};

function introContinue(e){
  if(e.key==='Enter'){
    introDone = true;
    introText.style.display='none';
    document.removeEventListener('keydown', introContinue);
  }
}


// ===== INIT SCENE =====
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  // Lumi√®res
  const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
  hemiLight.position.set(0,200,0);
  scene.add(hemiLight);

  const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
  dirLight.position.set(100,100,100);
  dirLight.castShadow = true;
  dirLight.shadow.mapSize.width = 2048;
  dirLight.shadow.mapSize.height = 2048;
  dirLight.shadow.camera.near = 0.5;
  dirLight.shadow.camera.far = 500;
  dirLight.shadow.camera.left = -50;
  dirLight.shadow.camera.right = 50;
  dirLight.shadow.camera.top = 50;
  dirLight.shadow.camera.bottom = -50;
  scene.add(dirLight);

  // Cam√©ra
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,2,5);

  // Sol
  const loaderGrass = new THREE.TextureLoader();
  const groundTexture = loaderGrass.load('./textures/grass.jpg');
  groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
  groundTexture.repeat.set(20,20);
  const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(100,100),
    new THREE.MeshStandardMaterial({map:groundTexture})
  );
  plane.rotation.x = -Math.PI/2;
  plane.receiveShadow = true;
  scene.add(plane);

  // Nuages multiples
  function getRandomFloat(min, max) {
  return Math.random() * (max - min) + min;
}
let randomFloat = getRandomFloat(10, 20);
  const cloudTex = loaderGrass.load('./textures/clouds.png');
  cloudTex.encoding = THREE.sRGBEncoding;
  const cloudMaterial = new THREE.MeshBasicMaterial({map:cloudTex, transparent:true, side:THREE.DoubleSide});
  for(let i=0;i<10;i++){
    const cloudGeo = new THREE.PlaneGeometry(15,8);
    const cloud = new THREE.Mesh(cloudGeo, cloudMaterial.clone());
    cloud.position.set(getRandomFloat(-100, 100),getRandomFloat(0, 20),getRandomFloat(-50, -120));
    cloud.rotation.set(0, getRandomFloat(-0.25, 0.25)*Math.PI, getRandomFloat(-0.25, 0.25)*0.2);
    scene.add(cloud);
  }

  // Renderer
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // Charger Snoopy
  const loader = new GLTFLoader();
  loader.load('./models/snoopy.glb', gltf=>{
    player = gltf.scene;
    player.scale.set(0.4,0.4,0.4);
    player.position.set(0,0,0);
    player.traverse(c=>{ if(c.isMesh){ c.castShadow=true; c.receiveShadow=false; } });
    scene.add(player);
    if(gltf.animations.length>0){ mixer = new THREE.AnimationMixer(player); mixer.clipAction(gltf.animations[0]).play(); }
  });

  // Charger NPC
  loader.load('./models/2d.glb', gltf=>{
    npc = gltf.scene;
    npc.scale.set(3,3,3);
    npc.position.set(0,-0.15,-15);
    npc.traverse(c=>{ if(c.isMesh){ c.castShadow=true; c.receiveShadow=false; } });
    scene.add(npc);
  });

  // Clavier
  document.addEventListener('keydown', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=true; if(e.key==='e') tryTalk(); });
  document.addEventListener('keyup', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=false; });
  window.addEventListener('resize', onWindowResize);
}

// ===== DEPLACEMENT =====
function movePlayer(){
  if(!player) return;
  let moved=false;
  if(keys.z){ player.position.z -= moveSpeed; moved=true; }
  if(keys.s){ player.position.z += moveSpeed; moved=true; }
  if(keys.q){ player.position.x -= moveSpeed; moved=true; }
  if(keys.d){ player.position.x += moveSpeed; moved=true; }

  if(moved){
    const dir = new THREE.Vector3(
      (keys.d?1:0)-(keys.q?1:0),
      0,
      (keys.s?1:0)-(keys.z?1:0)
    );
    if(dir.lengthSq()>0){ dir.normalize(); player.lookAt(player.position.x+dir.x,player.position.y,player.position.z+dir.z); }
  }

  // Cam√©ra suit
  const camOffset = new THREE.Vector3(0,2,5);
  const camPos = player.position.clone().add(camOffset);
  camera.position.lerp(camPos,0.1);
  camera.lookAt(player.position);

  // Afficher texte interaction NPC
  if(npc){
    const dist = player.position.distanceTo(npc.position);
    npcHint.style.display = dist<npcDistance && !quizStarted ? 'block':'none';
  }
}

// ===== INTERACTION QUIZ =====
let quizStarted = false;

function tryTalk(){
  if(!npc || !player) return;
  const dist = player.position.distanceTo(npc.position);
  if(dist < npcDistance && !quizStarted){
    startQuiz();
  }
}

function startQuiz(){
  quizStarted = true;           // üîπ on marque que le quiz est lanc√©
  npcHint.style.display = 'none';
  quizText.style.display = 'block';
  currentQuestion = 0;
  showQuestion();
}

function showQuestion(){
  if(currentQuestion >= quiz.length){
    // üîπ Quiz termin√© : redirection vers le niveau 2
    window.location.href = 'niveau2.html';
    return;
  }

  const q = quiz[currentQuestion];
  questionText.textContent = q.q;
  answersDiv.innerHTML = "";
  q.a.forEach((ans, i) => {
    const btn = document.createElement('button');
    btn.textContent = ans;
    btn.onclick = () => {
      if(i === q.correct){
        alert("Bonne r√©ponse !");
        currentQuestion++;
        showQuestion();
      } else {
        alert("Mauvaise r√©ponse ! Le quiz recommence.");
        startQuiz();
      }
    };
    answersDiv.appendChild(btn);
  });
}


// ===== ANIMATION =====
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  if(mixer) mixer.update(delta);
  movePlayer();
  renderer.render(scene,camera);
}

function onWindowResize(){
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>
=======
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>L'aventure de Soso et Nana</title>
<style>
html, body { margin: 0; height: 100%; overflow: hidden;  background-image: url('./textures/love.jpg');  background-size: cover;       /* couvre tout l'√©cran */
  background-position: center;  /* centr√©e */
  background-repeat: no-repeat;
font-family: sans-serif; }
#titleScreen, #introText, #npcHint, #quizText {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  text-align: center;
  max-width: 600px;
}
#titleScreen button, #quizText button {
  margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 6px;
}
#npcHint { display:none; font-size: 18px; }
</style>
</head>
<body>

<div id="titleScreen">
  <h1>L'aventure de Soso et Nana</h1>
  <button id="startBtn">Jouer</button>
</div>

<div id="introText" style="display:none;">
  Bonjour Sonia, te voil√† dans la peau de Snoopy afin de traverser une super aventure sem√©e d'emb√ªches pour d√©couvrir l'activit√© pr√©vue aujourd'hui. Ta premi√®re mission est d'aller s√©duire ce beau gar√ßon avec son t-shirt Gorillaz, te souviens-tu de tout ?<br>
  <small>Appuie sur Entr√©e pour continuer</small>
</div>

<div id="npcHint">Appuie sur E pour lui parler</div>

<div id="quizText" style="display:none;">
  <p id="questionText"></p>
  <div id="answers"></div>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.121.1/examples/jsm/loaders/GLTFLoader.js';

let scene, camera, renderer, clock = new THREE.Clock();
let player, mixer, npc;
let keys = { z:false, q:false, s:false, d:false };
let introDone = false;
const moveSpeed = 0.08;
const npcDistance = 2;

const startBtn = document.getElementById('startBtn');
const titleScreen = document.getElementById('titleScreen');
const introText = document.getElementById('introText');
const npcHint = document.getElementById('npcHint');
const quizText = document.getElementById('quizText');
const questionText = document.getElementById('questionText');
const answersDiv = document.getElementById('answers');

const quiz = [
  { q: "Quel artiste j'avais en fond d'√©cran lorsqu'on a commenc√© √† se parler ?", a: ["Khali", "Ptite Soeur", "Frank Ocean"], correct: 2 },
  { q: "Quel pull que je portais √† la soir√©e halloween (quand je suis tomb√© amoureux) ?", a: ["Pull MMI 1√®re ann√©e", "Mon pull gris que tu aimes bien", "Mon pull blanc avec un R"], correct: 1 },
  { q: "Quel wikihow j'ai consult√© la premi√®re fois qu'on s'est vraiment parler ?", a: ["Comment gagner une bagarre", "Comment √©viter d'√™tre agress√© dans la rue", "Comment se cacher d'un tueur"], correct: 2 },
];
let currentQuestion = 0;

startBtn.onclick = () => {
  titleScreen.style.display = 'none';

  // üîπ on initialise le d√©cor tout de suite
  init();

  // üîπ on affiche le texte d'intro par-dessus
  introText.style.display = 'block';
  document.addEventListener('keydown', introContinue);

  // üîπ on commence quand m√™me l'animation pour voir le d√©cor en arri√®re-plan
  animate();
};

function introContinue(e){
  if(e.key==='Enter'){
    introDone = true;
    introText.style.display='none';
    document.removeEventListener('keydown', introContinue);
  }
}


// ===== INIT SCENE =====
function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  // Lumi√®res
  const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
  hemiLight.position.set(0,200,0);
  scene.add(hemiLight);

  const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
  dirLight.position.set(100,100,100);
  dirLight.castShadow = true;
  dirLight.shadow.mapSize.width = 2048;
  dirLight.shadow.mapSize.height = 2048;
  dirLight.shadow.camera.near = 0.5;
  dirLight.shadow.camera.far = 500;
  dirLight.shadow.camera.left = -50;
  dirLight.shadow.camera.right = 50;
  dirLight.shadow.camera.top = 50;
  dirLight.shadow.camera.bottom = -50;
  scene.add(dirLight);

  // Cam√©ra
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,2,5);

  // Sol
  const loaderGrass = new THREE.TextureLoader();
  const groundTexture = loaderGrass.load('./textures/grass.jpg');
  groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
  groundTexture.repeat.set(20,20);
  const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(100,100),
    new THREE.MeshStandardMaterial({map:groundTexture})
  );
  plane.rotation.x = -Math.PI/2;
  plane.receiveShadow = true;
  scene.add(plane);

  // Nuages multiples
  function getRandomFloat(min, max) {
  return Math.random() * (max - min) + min;
}
let randomFloat = getRandomFloat(10, 20);
  const cloudTex = loaderGrass.load('./textures/clouds.png');
  cloudTex.encoding = THREE.sRGBEncoding;
  const cloudMaterial = new THREE.MeshBasicMaterial({map:cloudTex, transparent:true, side:THREE.DoubleSide});
  for(let i=0;i<10;i++){
    const cloudGeo = new THREE.PlaneGeometry(15,8);
    const cloud = new THREE.Mesh(cloudGeo, cloudMaterial.clone());
    cloud.position.set(getRandomFloat(-100, 100),getRandomFloat(0, 20),getRandomFloat(-50, -120));
    cloud.rotation.set(0, getRandomFloat(-0.25, 0.25)*Math.PI, getRandomFloat(-0.25, 0.25)*0.2);
    scene.add(cloud);
  }

  // Renderer
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // Charger Snoopy
  const loader = new GLTFLoader();
  loader.load('./models/snoopy.glb', gltf=>{
    player = gltf.scene;
    player.scale.set(0.4,0.4,0.4);
    player.position.set(0,0,0);
    player.traverse(c=>{ if(c.isMesh){ c.castShadow=true; c.receiveShadow=false; } });
    scene.add(player);
    if(gltf.animations.length>0){ mixer = new THREE.AnimationMixer(player); mixer.clipAction(gltf.animations[0]).play(); }
  });

  // Charger NPC
  loader.load('./models/2d.glb', gltf=>{
    npc = gltf.scene;
    npc.scale.set(3,3,3);
    npc.position.set(0,-0.15,-15);
    npc.traverse(c=>{ if(c.isMesh){ c.castShadow=true; c.receiveShadow=false; } });
    scene.add(npc);
  });

  // Clavier
  document.addEventListener('keydown', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=true; if(e.key==='e') tryTalk(); });
  document.addEventListener('keyup', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=false; });
  window.addEventListener('resize', onWindowResize);
}

// ===== DEPLACEMENT =====
function movePlayer(){
  if(!player) return;
  let moved=false;
  if(keys.z){ player.position.z -= moveSpeed; moved=true; }
  if(keys.s){ player.position.z += moveSpeed; moved=true; }
  if(keys.q){ player.position.x -= moveSpeed; moved=true; }
  if(keys.d){ player.position.x += moveSpeed; moved=true; }

  if(moved){
    const dir = new THREE.Vector3(
      (keys.d?1:0)-(keys.q?1:0),
      0,
      (keys.s?1:0)-(keys.z?1:0)
    );
    if(dir.lengthSq()>0){ dir.normalize(); player.lookAt(player.position.x+dir.x,player.position.y,player.position.z+dir.z); }
  }

  // Cam√©ra suit
  const camOffset = new THREE.Vector3(0,2,5);
  const camPos = player.position.clone().add(camOffset);
  camera.position.lerp(camPos,0.1);
  camera.lookAt(player.position);

  // Afficher texte interaction NPC
  if(npc){
    const dist = player.position.distanceTo(npc.position);
    npcHint.style.display = dist<npcDistance && !quizStarted ? 'block':'none';
  }
}

// ===== INTERACTION QUIZ =====
let quizStarted = false;

function tryTalk(){
  if(!npc || !player) return;
  const dist = player.position.distanceTo(npc.position);
  if(dist < npcDistance && !quizStarted){
    startQuiz();
  }
}

function startQuiz(){
  quizStarted = true;           // üîπ on marque que le quiz est lanc√©
  npcHint.style.display = 'none';
  quizText.style.display = 'block';
  currentQuestion = 0;
  showQuestion();
}

function showQuestion(){
  if(currentQuestion >= quiz.length){
    // üîπ Quiz termin√© : redirection vers le niveau 2
    window.location.href = 'niveau2.html';
    return;
  }

  const q = quiz[currentQuestion];
  questionText.textContent = q.q;
  answersDiv.innerHTML = "";
  q.a.forEach((ans, i) => {
    const btn = document.createElement('button');
    btn.textContent = ans;
    btn.onclick = () => {
      if(i === q.correct){
        alert("Bonne r√©ponse !");
        currentQuestion++;
        showQuestion();
      } else {
        alert("Mauvaise r√©ponse ! Le quiz recommence.");
        startQuiz();
      }
    };
    answersDiv.appendChild(btn);
  });
}


// ===== ANIMATION =====
function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  if(mixer) mixer.update(delta);
  movePlayer();
  renderer.render(scene,camera);
}

function onWindowResize(){
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>
>>>>>>> master
